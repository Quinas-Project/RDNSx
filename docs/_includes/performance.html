<!-- Performance Optimizations -->
<!-- Preconnect to external domains -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://github.com" crossorigin>

<!-- DNS prefetch for external resources -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
<link rel="dns-prefetch" href="//github.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">

<!-- Resource hints for critical resources -->
{% if page.image %}
<link rel="preload" href="{{ page.image | absolute_url }}" as="image" type="image/webp">
{% endif %}

<!-- Preload critical CSS -->
<link rel="preload" href="{{ '/assets/css/style.css' | relative_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}"></noscript>

<!-- Critical CSS for above-the-fold content -->
<style>
/* Critical CSS - Inline for fastest rendering */
body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; line-height: 1.6; color: #24292e; background-color: #ffffff; }
.site-header { background: #24292e; color: #ffffff; padding: 16px 0; }
.container-lg { max-width: 1280px; margin: 0 auto; padding: 0 16px; }
.d-flex { display: flex; }
.flex-justify-between { justify-content: space-between; }
.flex-items-center { align-items: center; }
.site-title { color: #ffffff; text-decoration: none; font-size: 24px; font-weight: 600; }
.site-title:hover { text-decoration: none; }
.site-nav-list { list-style: none; margin: 0; padding: 0; display: flex; }
.site-nav-list li { margin: 0 16px 0 0; }
.site-nav-list a { color: #ffffff; text-decoration: none; padding: 8px 12px; border-radius: 4px; }
.site-nav-list a:hover { background: rgba(255, 255, 255, 0.1); }
.markdown-body { box-sizing: border-box; min-width: 200px; max-width: none; margin: 0 auto; padding: 45px; }
h1, h2, h3, h4, h5, h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25; }
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
p { margin-top: 0; margin-bottom: 16px; }
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
code { background-color: rgba(27,31,35,.05); border-radius: 3px; font-size: .85em; margin: 0; padding: .2em .4em; }
pre { background-color: #f6f8fa; border-radius: 3px; font-size: 85%; line-height: 1.45; overflow: auto; padding: 16px; }
table { border-collapse: collapse; width: 100%; margin-bottom: 16px; }
th, td { border: 1px solid #dfe2e5; padding: 6px 13px; text-align: left; }
th { background-color: #f6f8fa; font-weight: 600; }

/* Loading states */
.loading-skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}
@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Skip link */
.skip-link {
  position: absolute;
  top: -40px;
  left: 6px;
  background: #0366d6;
  color: white;
  padding: 8px;
  text-decoration: none;
  border-radius: 4px;
  z-index: 1000;
  font-size: 14px;
}
.skip-link:focus { top: 6px; }
</style>

<!-- Non-critical CSS preload -->
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"></noscript>

<script>
// Performance monitoring and optimizations
(function() {
  // Mark when DOM is interactive
  document.addEventListener('DOMContentLoaded', function() {
    if ('performance' in window && 'mark' in window.performance) {
      window.performance.mark('dom-interactive');
    }
  });

  // Mark when page is fully loaded
  window.addEventListener('load', function() {
    if ('performance' in window && 'mark' in window.performance) {
      window.performance.mark('page-loaded');

      // Measure and report key metrics
      try {
        const navigation = window.performance.getEntriesByType('navigation')[0];
        const paint = window.performance.getEntriesByType('paint');

        // Log performance metrics (can be sent to analytics)
        console.log('Performance Metrics:', {
          'DOM Content Loaded': navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
          'Load Event': navigation.loadEventEnd - navigation.loadEventStart,
          'First Paint': paint.find(p => p.name === 'first-paint')?.startTime,
          'First Contentful Paint': paint.find(p => p.name === 'first-contentful-paint')?.startTime
        });
      } catch (e) {
        // Silently fail if performance API is not fully supported
      }
    }
  });

  // Optimize scrolling performance
  let scrollTimeout;
  window.addEventListener('scroll', function() {
    if (!scrollTimeout) {
      document.documentElement.classList.add('scrolling');
    }

    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(function() {
      document.documentElement.classList.remove('scrolling');
    }, 150);
  });

  // Reduce motion for users who prefer it
  if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    document.documentElement.classList.add('reduced-motion');

    // Disable animations
    const style = document.createElement('style');
    style.textContent = `
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    `;
    document.head.appendChild(style);
  }

  // Connection quality detection
  if ('connection' in navigator) {
    const connection = navigator.connection;
    document.documentElement.classList.add(`connection-${connection.effectiveType}`);

    connection.addEventListener('change', function() {
      // Remove old class
      document.documentElement.classList.forEach(cls => {
        if (cls.startsWith('connection-')) {
          document.documentElement.classList.remove(cls);
        }
      });
      // Add new class
      document.documentElement.classList.add(`connection-${connection.effectiveType}`);
    });
  }
})();
</script>

<!-- Critical resource hints -->
{% if site.google_analytics %}
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ site.google_analytics }}');
</script>
{% endif %}